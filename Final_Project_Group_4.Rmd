---
title: "Final Project Report Group 4"
author: "Hanbo Dong, Huiye Han, Yifan Lu, Zhuoran Li"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    fig_height: 4.5
    fig_width: 8

---
## Introduction

This report investigates a critical public health question: "What mental and sociodemographic factors were significantly associated with sleep quality among young adults and adults in the United States in 2013?" Sleep is a crucial component of overall health, impacting physical, mental, and emotional well-being (Bixler, 2009). The focus on this question is not only academically significant but also of important clinical relevance. Poor sleep has been increasingly problematic in the American population (Knutson et al., 2010). Revealing specific risk factors can guide the development of tailored treatments and interventions, based on patients' mental and social status.

The scope of the study extends beyond merely evaluating sleep qualities. It fundamentally addresses quality of life aspects, including physical, mental, and emotional well-being. Gaining insights into factors that influence sleep patterns is crucial for enhancing sleep hygiene practices and overall public health (Gottlieb et al., 2006). Although existing research has highlighted the impact of sociodemographic and mental health factors on sleep quality, the extent and nature of this impact are still debated, such as the influence of gender and mental illness (Van Cauter & Spiegel, 1999; Hale & Do, 2007; Krueger & Friedman, 2009; Buxton & Marcelli, 2010). Clarifying these relationships requires in-depth statistical research.

The approach taken in this study involves utilising a robust database and validated statistical methods. The aim is to reveal the complex relationships between sleep quality and various influential factors. Our study is intended to contribute to both the academic field and practical applications in public health strategies and individual well-being, addressing the identified limitations and controversies in previous studies.


## Method

### Data set details

The dataset under study is derived from the Behavioral Risk Factor Surveillance System, a comprehensive telephone survey conducted in all 50 states in 2013. Our research focuses on young adults(18-25) and adults(26-64) who participated in this survey.
Referring to the sleep time duration recommendations provided by the National Sleep Foundation, we have deliberately restricted our analysis to individuals aged 18 to 64. This decision stems from the good sleep  time varies among different age groups.Young adults and adults are recommended to have 7-9 hours of quality sleep per day, whereas older adults are advised to aim for 7-8 hours (Hirshkowitz et al., 2015). Considering that this duration difference is the result of the impact of many factors, such as living environment, psychological state and physical state, the factors influencing sleep quality in the elderly are considered to be quite different from those in other age groups.
 
In this study, we have adopted an approach where young adults and adults with a sleep duration falling within the range of 7-9 hours are categorized as having good sleep quality. Conversely, individuals with sleep durations below 7 hours or exceeding 9 hours are classified as having poorer sleep quality. This categorization stems from the consideration that both excessively long and excessively short sleep durations are compromised sleep quality. Since our study aims to focus on factors related to high sleep quality, it will be critical to clarify the boundaries between high and low sleep quality. The information lost by not specifically categorizing low sleep quality does not significantly affect our findings.
 
Our dataset comprises nine independent variables encompassing sociodemographic and mental health factors. It's worth noting that the majority of the survey questions were multiple-choice, so there are eight categorical variables and only one numerical variable. To handle ordered categorical variables, we applied ordinal encoding, which assigns numerical values to categories based on their natural order. Lower values in these variables indicate lower degrees or negative responses. 

The variables include:
 
#### Mental factors

**MISTMNT**(Binary): Currently receiving mental health treatment or not.

**MISPHLPF**(Ordinal):The level of recognition of others' empathy

**MISHOPLES** (Ordinal): The degree of hopelessness experienced.

**MISNOWRK** (Numerical): The number of workdays in a month impacted by mental illness.
 
#### Sociodemographic factors 

**Sex**(Binary): Female =1, Male =0

**X_EDUCA**(Categorical): The level of the highest level of education

**X_INCOMG**(Categorical): The level of income

**X_BMI5CAT**(Categorical): The category of BMI

**VETERAN3** (Binary): Have military experience or not
 
#### Outcome variable

**Sleep_well**(Binary): Sleep quality (Sleep_well = 1:sleep godd; Sleep_well = 0:sleep
bad )

### Research Methodology

Our research follows a systematic approach:

**Descriptive Statistics** 

We begin by conducting descriptive statistics to visualize the distribution of sleep quality across various factors. This involves utilizing stacked bar charts and mosaic charts to provide a comprehensive overview.

**Association Analysis**

We proceed to examine the associations between the nine mental and sociodemographic factors and sleep quality. Our choice of statistical tests depends on the data type. For ordered categorical variables, we generate expected tables to determine whether to employ the Fisher's exact test or the Chi-square test. For numerical variables, normality tests are conducted to guide our selection of the appropriate statistical test.

Chi-square tests compare the observed frequency of a class in a dataset with the expected frequency under the hypothesis that there is no association between the variables. It calculates chi-square statistics, measuring the difference between the observed and expected counts. The significant results suggest that this variable may be associated with sleep quality.

The Wilcoxon test is a method of comparing two sets of data in a non-normal distribution and is suitable for assessing the difference between good and poor sleep quality. By ranking and scoring two sets of data, it examines whether one group is systematically ranked higher or lower than the other. If significant differences are found, this may indicate that sleep quality is associated with the variables studied.

**Regression Analysis**

To establish the relationship between the independent variables and sleep quality, we utilize binary logistic regression due to our binary outcome. Binary logistic regression is employed to examine the relationship between multiple independent variables and a binary outcome.  This model calculates the odds of the outcome occurring as a function of the independent variables. 

A key assumption in our analysis was the use of ordinal encoding for categorical variables. This approach involves converting category data with natural ordered relationships into numerical values, with smaller values typically indicating a negative or lower degree. For example, levels of education were encoded from lowest to highest educational attainment. While this encoding assumes consistency in the differences between each category, it is a necessary simplification for the logistic regression model.
Subsequently, we assess whether the data meets the necessary model assumptions. Tests of assumptions include whether the dependent variable is binary and whether there is no multicollinearity between the independent variables. As our dataset boasts a substantial sample size, we disregard the influence of outliers. A collinearity test through the Variance Inflation Factor (VIF) is also performed. 

Model adjustments are made through data transformation and the backward stepwise method. Data transformations include logarithmic transformations, square (or power) transformations, and Box-Cox transformations, which are used to stabilize the variance and normalize the distribution of the biased data, reduce skewness, and standardize residuals and stable variances, respectively. Backward stepwise regression starts with a model containing all potential independent variables. It iteratively removes the least significant variable, one at a time, based on a specified criterion, such as the highest p-value. This process continues until only variables that have a significant contribution to the model's predictive power remain. In addition to data transformation, model improvement we also consider includes backward stepwise filtering methods. Backward stepwise regression starts with a model that contains all potential independent variables. It iteratively removes the least important variables, one at a time, according to specified criteria, such as the highest p-value. This process continues until only the variables that contribute significantly to the model's predictive power are left.

In the final phase of model evaluation, we use two key metrics to evaluate the performance and appropriateness of the logistic regression model. Hosmer and Lemeshow goodness of fit tests divide the data set into deciles based on prediction probabilities and compare the observed and expected frequencies of binary outcomes in these deciles. The results of the non-significance test (high P-value) show that there is no significant difference between the predicted and observed values of the model, indicating a good fit. The second is the Akaike Information Standard (AIC), which balances the complexity of the model with how well it fits the data, penalizing overly complex models. A lower AIC indicates that the model can better explain the variability of the data with fewer variables, thus providing a means to compare the goodness of fit of different models.

This rigorous methodology enables us to comprehensively explore the relationships between various factors and sleep quality within our dataset, providing valuable insights into this critical health aspect.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo =FALSE, message = FALSE, warning = FALSE)
```

```{r,message=FALSE,echo=FALSE}
library(gtsummary)
library(dplyr)
library(readr)
library(ggplot2)
library(grid)
library(patchwork)
library(kableExtra)
library(tidyverse)
library(here)
library(janitor)
library(broom)
library(ResourceSelection)
library(pROC)
library(tidyr)
```

```{r, echo=FALSE}
# Load in data
load("brfss2013.RData")
brfss2013 <- clean_names(brfss2013)

# Selecting factors
factors <- tolower(c("SLEPTIM1", "X_AGE65YR", 
                     "MISHOPLS", "MISTMNT", "MISPHLPF", "MISNOWRK",
                     "SEX", "X_EDUCAG", "X_INCOMG", "VETERAN3", "X_BMI5CAT"))

brfss_sleep_mental <- brfss2013 %>%
  select(factors)
# head(brfss_sleep_mental)
# skimr::skim(brfss_sleep_mental)

# Remove "Don’t know/Not sure/Missing" for _INCOMG,
# Keep Yes and No for internet,
# Keep the first five for misphlpf,
# Keep the first few for x_incomg
brfss_sleep_mental <- brfss_sleep_mental %>%
  filter(!x_incomg == "Don’t know/Not sure/Missing") %>%
  filter(misphlpf %in% c("Disagree strongly", 
                         "Disagree slightly", 
                         "Neither agree nor disagree", 
                         "Agree slightly",
                         "Agree strongly")) %>%
  filter(x_incomg %in% c("Less than $15,000", 
                         "$15,000 to less than $25,000", 
                         "$25,000 to less than $35,000",
                         "$35,000 to less than $50,000",
                         "$50,000 or more")) %>%
  filter(!x_educag == "9") %>%
  filter(veteran3 %in% c("Yes", "No"))

# Delete overall missing values
brfss_sleep_mental_omit <- na.omit(brfss_sleep_mental)
# head(brfss_sleep_mental_omit)
# skimr::skim(brfss_sleep_mental_omit)

# Creating 'adult' based on population age, indicating whether a person is an adult (1: adult, 0: older than 65)
brfss_sleep_mental_omit <- brfss_sleep_mental_omit %>%
  filter(x_age65yr == "Age 18 to 64")

# Sleep rating
brfss_sleep_mental <- brfss_sleep_mental_omit %>%
  mutate(sleep_well = case_when(
    sleptim1 >= 7 & sleptim1 <= 9 ~ "good",
    sleptim1 < 7 ~ "bad",
    sleptim1 > 9 ~ "bad"))

# Convert mishopls (degree of losing hope) to numeric ordinal data
brfss_sleep_mental <- brfss_sleep_mental %>%
  mutate(mishopls = case_when(
    mishopls == "None" ~ "0", # 0: Lowest degree of losing hope
    mishopls == "A little" ~ "1",
    mishopls == "Some" ~ "2",
    mishopls == "Most" ~ "3",
    mishopls == "All" ~ "4")) # 4: Highest degree of losing hope

# mistmnt (whether receiving treatment)
brfss_sleep_mental <- brfss_sleep_mental %>%
  mutate(mistmnt = case_when(
    mistmnt == "Yes" ~ "1", # 1: Receiving treatment
    mistmnt == "No" ~ "0")) # 0: Not receiving treatment

# Convert misphlpf (whether agreeing with people caring and sympathizing with mental illness patients) to numeric ordinal data
brfss_sleep_mental <- brfss_sleep_mental %>%
  mutate(misphlpf = case_when(
    misphlpf == "Disagree strongly" ~ "0", # 0: Completely disagree with people caring for mental illness patients
    misphlpf == "Disagree slightly" ~ "1",
    misphlpf == "Neither agree nor disagree" ~ "2",
    misphlpf == "Agree slightly" ~ "3",
    misphlpf == "Agree strongly" ~ "4")) 

# Convert sex to numeric categorical variable
brfss_sleep_mental <- brfss_sleep_mental %>%
  mutate(sex = case_when(
    sex == "Male" ~ "1", # 1:Male
    sex == "Female" ~ "0")) # 0:Female

# Convert x_incomg (income level, categorized by the survey) to numeric ordinal data
brfss_sleep_mental <- brfss_sleep_mental %>%
  mutate(x_incomg = case_when(
    x_incomg == "Less than $15,000" ~ "1",
    x_incomg == "$15,000 to less than $25,000" ~ "2",
    x_incomg == "$25,000 to less than $35,000" ~ "3",
    x_incomg == "$35,000 to less than $50,000" ~ "4",
    x_incomg == "$50,000 or more" ~ "5")) 

# Convert x_educag to numeric ordinal data
brfss_sleep_mental <- brfss_sleep_mental %>%
  mutate(x_educag = case_when(
    x_educag == "Did not graduate high school" ~ "1", # 1：lowest education level
    x_educag == "Graduated high school" ~ "2",
    x_educag == "Attended college or technical school" ~ "3",
    x_educag == "Graduated from college or technical school" ~ "4"))

# Convert veteran3 to binary data
brfss_sleep_mental <- brfss_sleep_mental %>%
  mutate(veteran3 = case_when(
    veteran3 == "Yes" ~ "1", # 1：was veteran
    veteran3 == "No" ~ "0")) # 0: wasa not veteran

# Covert x_bmi5cat to numeric ordinal data
brfss_sleep_mental <- brfss_sleep_mental %>%
  mutate(x_bmi5cat = case_when(
    x_bmi5cat == "Underweight" ~ "1", # 1：Underweight
    x_bmi5cat == "Normal weight" ~ "2",
    x_bmi5cat == "Overweight" ~ "3",
    x_bmi5cat == "Obese" ~ "4")) # 4: Obese

# Delete x_age65yr column
brfss_sleep_mental <- brfss_sleep_mental %>%
  select(!x_age65yr)

# Delete x_educag column
brfss_sleep_mental <- brfss_sleep_mental %>%
  filter(!x_educag == "NA")

# write_csv(brfss_sleep_mental, here("data.csv"))
```



```{r}
# Load data
data <- brfss_sleep_mental
```

## Results


```{r}
table1 <- data %>%
  select(mistmnt, misphlpf, mishopls, misnowrk, sex, x_educag, x_incomg, veteran3, x_bmi5cat, sleep_well) %>%
  tbl_summary(
    by = sleep_well,
    statistic = list(all_continuous()  ~ "{mean} ({sd})",
                     all_categorical() ~ "{n}    ({p}%)"),
    digits = list(all_continuous()  ~ c(2, 2),
                  all_categorical() ~ c(0, 1)),
    type = list(mistmnt   ~ "categorical",
                misphlpf   ~ "categorical",
                mishopls   ~ "categorical",
                misnowrk   ~ "continuous",
                sex   ~ "categorical",
                x_educag ~ "categorical",
                x_incomg ~ "categorical",
                veteran3 ~ "categorical",
                x_bmi5cat ~ "categorical"
    )
  ) %>%
  add_p(
    test = list(
      all_continuous() ~ "wilcox.test",
      all_categorical() ~ "chisq.test"
    ),
    pvalue_fun = function(x) style_pvalue(x, digits = 3)
  )%>%
  modify_header(label = "**Variable**") %>%
  modify_spanning_header(all_stat_cols() ~ "**Sleep Quality**") %>%
  modify_caption("Table 1: Sociodemographic and Mental Factors by Sleep Quality") %>%
  as_kable_extra(booktabs = TRUE) %>%
  # reduce font size to make table fit. 
  # you may also use the `latex_options = "scale_down"` argument here.
  kableExtra::kable_styling(bootstrap_options = "striped", full_width = T)
table1
```

We first provide a preliminary summary of the data using the tableone (table 1) to help determine which independent variables might be related to the dependent variables. In this table, we categorised sleep quality into two categories: "bad (N = 7045)" and "good (N = 12591)", looking at the difference between good and bad sleep quality for each mental and Sociodemographic factors. By observing the P-value, it can be found that there is a significant association between the above nine variables and sleep quality (p < 0.001).


### Visualize and Test the Association

#### Mental Factors


```{r}
# Define a function to create the bar chart
create_bar_chart <- function(data, x_var, title) {
  ggplot(data, aes_string(x = x_var, fill = "sleep_well")) +
    geom_bar(position = "fill") +
    labs(x = x_var, y = "Percentage", fill = "Sleep Quality", title = title) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, size = 11))
}

# Transform the data
data_combine <- data %>%
  mutate(
    mistmnt = ifelse(mistmnt == "1", "Yes", "No"),
    veteran3 = ifelse(veteran3 == "1", "Yes", "No"),
    sex = ifelse(sex == "1", "Male", "Female")
  )

# Generate plots
p1 <- create_bar_chart(data_combine, 
                       "mistmnt", 
                       "Treatment Condition VS. Sleep Quality")
p2 <- create_bar_chart(data_combine, 
                       "misphlpf", 
                       "Recognition of Other's Empathy VS. Sleep Quality")
p3 <- create_bar_chart(data_combine, 
                       "mishopls", 
                       "Hopeless Level VS. Sleep Quality")
p4 <- create_bar_chart(data_combine, 
                       "misnowrk", 
                       "Now Working Days Due to Mental Issue \nVS. Sleep Quality")
p5 <- create_bar_chart(data_combine, 
                       "sex", 
                       "Gender VS. Sleep Quality")
p6 <- create_bar_chart(data_combine, 
                       "x_educag", 
                       "Level of education VS. Sleep Quality")
p7 <- create_bar_chart(data_combine, 
                       "x_incomg", 
                       "Income VS. Sleep Quality")
p8 <- create_bar_chart(data_combine, 
                       "x_bmi5cat", 
                       "BMI VS. Sleep Quality")
p9 <- create_bar_chart(data_combine, 
                       "veteran3", 
                       "Military experience \nVS. Sleep Quality")
```

```{r, fig.height= 9, fig.width=9}
# mental
# Assuming p1, p2, p3, p4 have been defined as per previous code

# Remove legends from individual plots
p2 <- p2 + theme(legend.position = "none")
p3 <- p3 + theme(legend.position = "none")
p4 <- p4 + theme(legend.position = "none")

# Combine the plots
combined_plot <- (p1 | p2) / (p3 | p4)

# Display the combined plot with a single shared legend on the right
final_plot <- combined_plot + 
  plot_layout(guides = "collect") +
  theme(legend.position = "right", legend.justification = "center") +
  plot_annotation(
    caption = "Figure 1: Bar Charts of Sociodemographic Factors by Sleep Quality. These charts show total values for each category and the relative contribution of each \nsubcategory. The trend of plot shows the difference between bars.",
    theme = theme(
      plot.title = element_text(hjust = 0.5),
      plot.caption = element_text(hjust = 0)
    )
  )

# Display the final plot
print(final_plot)
```

Categorical Variables
Stacked bar charts were used to visually compare the proportion of individuals with varying levels of sleep quality across different mental health-related categories (Figure 1). The "Treatment Condition vs. Sleep Quality" chart reveals a decreasing trend, where individuals currently receiving mental health treatment tend to report worse sleep quality. Similarly, the "Hopeless Level vs. Sleep Quality" chart shows that those with higher levels of hopelessness experience poorer sleep quality.

Interestingly, the chart illustrating "Recognition of Others' Empathy vs. Sleep Quality" displays a non-linear relationship. Individuals who moderately has recognition of others' empathy report better sleep quality, while those at the extremes (strong agreement or disagreement) tend to have poorer sleep quality. This pattern indicates a quadratic trend, where sleep quality peaks with moderate levels of perceived empathy and decreases at both lower and higher levels.

To statistically examine the association between these categorical mental health factors and sleep quality, chi-squared tests were conducted for "currently receiving mental health treatment" (mistmnt), "level of agreement on care provision for mental illness" (misphlpf), and "degree of hopelessness" (mishopls), given the large sample size of our data and expected cell frequencies exceeding the threshold of 5 (See Appendix 1).

Numeric Variable
The variable representing the number of workdays affected by mental health issues (misnowrk) was initially assessed with a bar chart, which indicated a non-normal distribution. This was further evidenced by a subsequent QQ-plot analysis.

```{r}
# Increase the bottom margin to make space for the caption
par(mar = c(5, 4, 4, 2) + 0.1)

# Create the QQ plot
qqnorm(data$misnowrk, main = "", xlab = "Theoretical Quantiles", ylab = "Sample Quantiles", cex.main = 1, font.main = 1.5)
qqline(data$misnowrk, col = 2)

# Add caption at the bottom of the plot
mtext("Figure 2: QQ Plot of misnowrk. The Q-Q plot exhibits skewness, indicating that the data does not follow a normal distribution.", 
      side = 1, line = 2, adj = 0, font = 1.5, cex = 0.8)
```

The QQ plot (Figure 2) visualizes the distribution of "misnowrk". The plot reveals a obvious skewness, with the data points significantly deviating from the reference line, confirming that the data does not follow a normal distribution.

Given the non-normality, the Wilcoxon rank-sum test is selected for analysis. This test is appropriate because it does not assume normality in the data and is robust for ordinal data and independent samples. The test will compare the median number of affected workdays between two independent groups – those with good versus poor sleep quality – to determine if there is a statistically significant difference in the impact of mental health on workdays between these two sleep quality statuses.

```{r}
data$sleep_well_binary <- ifelse(data$sleep_well == 'good', 1, 0)

#ad.test(data$mishopls)$p.value < 0.05
#ad.test(data$misnowrk)$p.value < 0.05

# Mental
test_mistmnt <- chisq.test(table(data$sleep_well_binary, data$mistmnt), correct=FALSE)
test_misphlpf <- chisq.test(table(data$sleep_well_binary, data$misphlpf), correct=FALSE)
test_mishopls <- chisq.test(table(data$sleep_well_binary, data$mishopls), correct=FALSE)
test_misnowrk <- wilcox.test(table(data$misnowrk, data$sleep_well))
# Social
test_sex <- chisq.test(table(data$sleep_well_binary, data$sex), correct=FALSE)
test_x_educag <- chisq.test(table(data$sleep_well_binary, data$x_educag), correct=FALSE)
test_x_incomg <- chisq.test(table(data$sleep_well_binary, data$x_incomg), correct=FALSE)
test_x_bmi5cat <- chisq.test(table(data$sleep_well_binary, data$x_bmi5cat), correct=FALSE)
test_veteran <- chisq.test(table(data$sleep_well_binary, data$veteran), correct=FALSE)

mental_data <- data.frame(
  `Mental Factors` = c("mistmnt", "misphlpf", "mishopls", "misnowrk"),
  `Test Type` = c("Chi-Square", "Chi-Square", "Chi-Square","Wilcoxon rank-sum"),
  `P-value` = c(test_mistmnt$p.value, test_misphlpf$p.value, test_mishopls$p.value, 
              test_misnowrk$p.value)
)
mental_data %>%
  kbl(caption = "Table 2: Table with Test Type and P-value of Mental Factors.") %>%
  kable_classic(full_width = F, html_font = "Cambria") 
```


A p-value of less than 0.05 was observed across all tests, indicating a statistically significant association between each of the mental factors and sleep quality. Specifically, for the categorical variables "mistmnt" (currently receiving mental health treatment), "misphlpf" (level of agreement on empathy), and "mishopls" (level of hopelessness), the Chi-Square test was utilized given the categorical nature of these variables and the large sample size.
For the numeric variable "misnowrk" (number of workdays affected by mental health issues), the Wilcoxon rank-sum test was chosen due to the non-normal distribution of the data as confirmed by the QQ plot analysis (Figure 2). The significant p-value suggests that there is a difference in the median number of affected workdays when comparing individuals with good versus poor sleep quality.

#### Sociodemograohic Factors



```{r, fig.height= 9, fig.width=9}
# Remove legends from all plots except one (for example, keep the legend in p5)
p6 <- p6 + theme(legend.position = "none")
p7 <- p7 + theme(legend.position = "none")
p8 <- p8 + theme(legend.position = "none")
p9 <- p9 + theme(legend.position = "none")

# Combine the plots
combined_plot1 <- (p5 | p6) / (p7 | p8 | p9)

# Display the combined plot with a single shared legend
combined_plot1 +
  plot_layout(guides = "collect") +
  plot_annotation(
    caption = "Figure 3: Stacked Bar Charts of Sociodemographic Factors by Sleep Quality. These charts show total values for each category and the relative contribution of each \nsubcategory. The trend in a plot shows the difference between bars.",
    theme = theme(
      plot.title = element_text(hjust = 0.5),
      plot.caption = element_text(hjust = 0)
    )
  ) +
  theme(legend.position = "top")
```

Following the analysis of mental health factors, the study explored sociodemographic influences on sleep quality. Stacked bar charts provided initial insights into the proportional differences in sleep quality across various sociodemographic categories (Figure 3).

Education and Income Trends
An increasing trend was observed in the "Level of Education vs. Sleep Quality" chart, where a higher level of education was associated with a greater proportion of individuals reporting good sleep quality. A similar trend was evident in the "Income vs. Sleep Quality" chart, suggesting that higher income levels might correlate with better sleep quality.

BMI and Sleep Quality
Contrastingly, the "BMI vs. Sleep Quality" chart revealed a non-linear trend. The proportion of individuals reporting good sleep quality did not increase consistently across BMI categories, indicating a more complex relationship that is similar to the quadratic trend observed in the level of agreement on empathy.

Gender and Military Experience
The analysis of gender and military experience using stacked bar charts did not demonstrate a clear distinction in sleep quality proportions between different categories. The relationship between these sociodemographic factors and sleep quality need to be further examination.



```{r, fig.width=9}
# mosaic plot
library(gridExtra)
library(grid)
# Set outer margins and divide the plot area into 1x2 layout
par(oma = c(6, 0, 0, 0), mfrow = c(1, 2))

# Create the mosaic plots
mosaicplot(table(data$sleep_well, data$veteran3), shade = TRUE, color = TRUE, main = "Sleep Quality VS. Veteran")
mosaicplot(table(data_combine$sleep_well, data_combine$sex), shade = TRUE, color = TRUE, main = "Sleep Quality VS. Gender")

# Add caption in the outer bottom margin
mtext("Figure 4: Mosaic Plots for Veteran and Gender by Sleep Quality. In mosaic plot, blue indicates more observations 
      than expected, red indicates fewer observations, and white means observed is approximately equal to expected.", 
      side = 1, outer = TRUE, line = 0, cex = 0.8)
```

Mosaic plots were utilized for further analysis (Figure 4). These plots show associations between sleep quality and both gender and veteran status. The blue area for males shows a higher proportion of poor sleep quality was observed. Similarly, veterans have lower proportion of good sleep quality. 

The findings from the mosaic plots suggest that being male or a veteran is associated with variations in sleep quality, with both groups showing a higher likelihood of experiencing poor sleep. 

For all four categorical variables, with expected values larger than 5, the Chi-square test is more suitable (See Appendix 1). 
In table 3, all p-values are less than 0.05, we reject the null hypothesis and conclude that there is an association between all sociodemographic factors and sleep quality.

```{r}
social_data <- data.frame(
  `Sociodemographic Factors` = c("sex",  "x_educag", "x_incomg", "x_bmi5cat", "veteran"),
  `Test Type` = c("Chi-Square", "Chi-Square", "Chi-Square", "Chi-Square","Chi-Square"),
  `P-value` = c(test_sex$p.value, test_x_educag$p.value, 
              test_x_incomg$p.value, test_x_bmi5cat$p.value, test_veteran$p.value)
)
social_data %>%
  kbl(caption = "Table 3: Table with Test Type and P-value of Sociodemographic Factors.") %>%
  kable_classic(full_width = F, html_font = "Cambria") 
```

In conclusion, the analyses showed significant associations between sleep qualify and all factors we tested in this study. 


### Binary Logistic Regression

The binary logistic regression model provided insightful results regarding the association between various sociodemographic and mental health factors and the probability of experiencing better sleep among U.S. young adults and adults.



```{r}
# process data for regression
data$sleptim1 <- as.numeric(data$sleptim1)
data$mistmnt <- as.numeric(data$mistmnt)
data$misphlpf <- as.numeric(data$misphlpf)
data$mishopls <- as.numeric(data$mishopls)
data$sex <- as.numeric(data$sex)
data$x_incomg <- as.numeric(data$x_incomg)
data$x_educag <- as.numeric(data$x_educag)
data$veteran3 <- as.numeric(data$veteran3)
data$x_bmi5cat <- as.numeric(data$x_bmi5cat)
```

```{r message=FALSE, warning=FALSE, echo=FALSE, include = FALSE}
model_linear <- glm(sleep_well_binary ~ mistmnt + misphlpf + mishopls + misnowrk + sex + x_educag + x_incomg + veteran3 +  x_bmi5cat, data = data, family =  binomial(link="logit"))
```

```{r message=FALSE, warning=FALSE, echo=FALSE}
# Fit the binary logistic regression model
model <- glm(sleep_well_binary ~ mistmnt + misphlpf + I(misphlpf^2) + mishopls + misnowrk + sex + x_educag + x_incomg + veteran3 +  x_bmi5cat + I(x_bmi5cat^2), data = data, family =  binomial(link="logit"))

output <- model %>% tidy()
# View the model summary
cbinded <- cbind(output, confint(model))[,-1] %>% round(3)
# Knit the table to latex format
cbinded %>%
  kbl(caption = "<b>Table 4:</b> Binary Logistic Regression Analysis with 95% CI") %>%
  kable_classic(full_width = F, html_font = "Calibri") %>%
  column_spec(1, bold = TRUE)
```

From Figure 1 and 3, the trend of **MISPHLPF** and **X_BMI5CAT** are not monotonic. Therefore, quadratic terms were introduced in the binary logistic regression model.
```{r message=FALSE, warning=FALSE, echo=FALSE, include = FALSE}
adjusted <- stats::step(model, direction = "backward")
summary(adjusted)
```


The regression model showed no difference after the backward stepwise filtering method.



### Model Fit Analysis

```{r}
# Perform the Hosmer-Lemeshow test
hoslem.test(y = model$fitted.values, x = model$model$sleep_well_binary, g = 10)

# Compute the ROC curve and AUC
roc_curve <- roc(response = model$y, predictor = fitted(model))
auc_value <- auc(roc_curve)

# Print the AUC
print(auc_value)

# Extract and print the Residual Deviance
residual_deviance <- deviance(model)
cat("Residual Deviance:", residual_deviance, "\n")

# Extract and print the AIC
aic_value <- AIC(model)
cat("AIC:", aic_value, "\n")

# Print the summary of the model to get detailed information
model_summary <- summary(model)

# Extract degrees of freedom
residual_dof <- model_summary$df.residual
null_dof <- model_summary$df.null

# Print the degrees of freedom
cat("Residual Degrees of Freedom:", residual_dof, "\n")
cat("Null Degrees of Freedom:", null_dof, "\n")
```

### Model Fit Analysis

**Hosmer and Lemeshow Goodness of Fit Test**
The fit of the statistical model was first assessed using the Hosmer and Lemeshow Goodness of Fit Test. This test resulted in an chi-squared value of 13.349 with 8 degrees of freedom, and a p-value of 0.1004. This suggests that the observed values and the model's predictions do not significantly differ, indicating a reasonable fit to the data. However, it's important to note that relying solely on the p-value does not fully encapsulate the model's overall fit.

**Residual Deviance vs. Residual Degrees of Freedom**
A further evaluation involved comparing the model's Residual Deviance against its Residual Degrees of Freedom. Typically, a smaller difference between these two values indicates a better fit. In this analysis, a noticeable difference was found, pointing towards potential room for improvement in the model’s fit.

**Area Under the Curve (AUC)**
The Area Under the Curve (AUC), which measures the model's capability to differentiate between various outcomes (in this case, levels of sleep quality), was calculated to be 0.64. While this is better than random chance, it is still below the acceptable level for discriminative ability.

**Implications of Model Fit**
From these assessments, it is inferred that the model is not sufficiently refined, but on the right track. It provides a starting point for accurate prediction of sleep quality. Future studies could adjust existing variables or incorporate new relevant variables to enhance the model’s accuracy. On the other hand, although there are some limitations in prediction, the inference from this model provides valuable insights into the factors influencing sleep quality, which will be further explored through the analysis of the model's coefficients.



### Key findings from the logistic regression analysis include:

Mental Health Variables:

**Mental Health Treatment** (mistmnt): This factor did not significantly alter the odds of better sleep, indicating that treatment status may not directly affect sleep quality within this population.

**Recognition of Others' Empathy** (misphlpf): Exhibited a non-linear effect on the odds of better sleep. Initially, increased perception of empathy is associated with higher odds of better sleep, but at very high levels, the trend reverses, suggesting a complex relationship.

**Feelings of Hopelessness** (mishopls): A rise in feelings of hopelessness is linked with decreased odds of better sleep, emphasizing the impact of mental state on sleep.

**Missing Work Due to Mental Health Issues** (misnowrk): More missed days at work due to mental health issues slightly lowered the odds of better sleep, highlighting the negative influence of mental health on sleep.

Sociodemographic Variables:

**Gender** (sex): Being male is associated with lower odds of better sleep compared to females, suggesting gender-based differences in sleep quality.

**Education Level** (x_educag): Higher education levels are correlated with increased odds of better sleep, possibly reflecting broader socio-economic and lifestyle factors.

**Income Level** (x_incomg): Higher income categories are linked with improved odds of better sleep, underscoring the role of economic stability.

**Veteran Status** (veteran3): Veterans report lower odds of better sleep compared to non-veterans, indicating unique challenges in this group.

**BMI** (x_bmi5cat): The relationship between BMI and sleep quality is non-linear. An increase in BMI initially corresponds with higher odds of better sleep, up to a certain point, after which the odds decrease, particularly in higher BMI categories.



## Conclusion
Our study offers a comprehensive analysis of how various sociodemographic and mental health factors are associated with the odds of achieving better sleep among the U.S. population aged between 18 to 64. The findings underscore the complexity of sleep quality determinants, revealing significant relationships with mental health aspects and sociodemographic factors.

### Broader Implications:
This study highlights the importance of a holistic view of sleep quality, emphasizing the complex interaction between mental health and sociodemographic factors. Such an understanding is crucial for developing comprehensive sleep management strategies, moving beyond traditional single-factor treatment models and incorporating a more integrated approach in clinical and public health settings.

### Potential Applications:
The findings provide valuable insights for healthcare providers, allowing for targeted interventions based on individuals' mental and sociodemographic profiles. Additionally, these insights can inform public health initiatives and policy development, focusing on improving sleep health through mental health support and addressing socio-economic factors.

### Recommendations for Future Research:
Future studies should aim to establish causal links between the identified factors and sleep quality, expanding upon the observational nature of this study. Longitudinal research and broader variable inclusion can deepen the understanding of sleep quality determinants. Diversifying data sources would also enhance the findings' applicability across various populations.

For the purposes of this study, we have chosen to concentrate on a binary classification of sleep quality. This decision provides valuable insights into the factors affecting high sleep quality. However, it is worth noting that if future research endeavors delve into analyzing the factors contributing to long or short sleep durations, it may be beneficial to further categorize the outcome variable into three classes. 

### Limitations and Considerations:
The study's limitations include potential selection bias due to a low survey response rate and the assumptions inherent in ordinal encoding of categorical variables. These factors may affect the generalizability of the findings and should be considered in interpreting the results. Future research should account for these limitations to refine our understanding of sleep quality determinants.



## Bibliography

Bixler, E. (2009). Sleep and society: An epidemiological perspective. Sleep Medicine, 10, S3–S6. m

Buxton, O. M., & Marcelli, E. (2010). Short and long sleep are positively associated with obesity, diabetes, hypertension, and cardiovascular disease among adults in the United States. Social science & medicine, 71(5), 1027-1036.

Gottlieb, D. J., Redline, S., Nieto, F. J., Baldwin, C. M., Newman, A. B., Resnick, H. E., & Punjabi, N. M. (2006). Association of usual sleep duration with hypertension: the Sleep Heart Health Study. Sleep, 29(8), 1009-1014.

Hale, L., & Do, D. P. (2007). Racial differences in self-reports of sleep duration in a population-based study. Sleep, 30(9), 1096-1103.

Hirshkowitz, M., Whiton, K., Albert, S. M., Alessi, C., Bruni, O., DonCarlos, L., ... & Hillard, P. J. A. (2015). National Sleep Foundation’s sleep time duration recommendations: methodology and results summary. Sleep health, 1(1), 40-43.

Knutson, K. L., Van Cauter, E., Rathouz, P. J., DeLeire, T., & Lauderdale, D. S. (2010). Trends in the prevalence of short sleepers in the USA: 1975–2006. Sleep, 33(1), 37.

Krueger, P. M., & Friedman, E. M. (2009). Sleep duration in the United States: a cross-sectional population-based study. American journal of epidemiology, 169(9), 1052-1063.

Van Cauter, E. V. E., & Spiegel, K. (1999). Sleep as a mediator of the relationship between socioeconomic status and health: a hypothesis. Annals of the New York Academy of Sciences, 896(1), 254-261.



